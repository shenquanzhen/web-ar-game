(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();let d,a,i,c,s,E,m=0,u=[],p=!1;function R(){a=new THREE.Scene,d=new THREE.Camera,a.add(d),i=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),i.setClearColor(new THREE.Color("lightgrey"),0),i.setSize(window.innerWidth,window.innerHeight),i.domElement.style.position="absolute",i.domElement.style.top="0px",i.domElement.style.left="0px",document.body.appendChild(i.domElement),T();const t=new THREE.AmbientLight(16777215,.5);a.add(t);const r=new THREE.DirectionalLight(16777215,.5);r.position.set(0,1,0),a.add(r),y(),window.addEventListener("click",h),window.addEventListener("touchstart",h),window.addEventListener("resize",H)}function T(){c=new THREEx.ArToolkitSource({sourceType:"webcam"}),c.init(function(){w()}),window.addEventListener("resize",function(){w()}),s=new THREEx.ArToolkitContext({cameraParametersUrl:"https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/camera_para.dat",detectionMode:"mono"}),s.init(function(){d.projectionMatrix.copy(s.getProjectionMatrix())}),E=new THREE.Group,a.add(E),new THREEx.ArMarkerControls(s,E,{type:"pattern",patternUrl:"https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro"})}function w(){c.onResizeElement(),c.copyElementSizeTo(i.domElement),s.arController!==null&&c.copyElementSizeTo(s.arController.canvas)}function y(){const t=new THREE.SphereGeometry(.5,32,32),r=new THREE.MeshPhongMaterial({color:16711680}),n=new THREE.Mesh(t,r);n.position.x=Math.random()*8-4,n.position.y=Math.random()*8-4,n.position.z=-Math.random()*5-2,a.add(n),u.push(n)}function h(t){if(!p)return;t.preventDefault();const r=new THREE.Raycaster,n=new THREE.Vector2;t.type==="click"?(n.x=t.clientX/window.innerWidth*2-1,n.y=-(t.clientY/window.innerHeight)*2+1):t.type==="touchstart"&&(n.x=t.touches[0].clientX/window.innerWidth*2-1,n.y=-(t.touches[0].clientY/window.innerHeight)*2+1),r.setFromCamera(n,d);const l=r.intersectObjects(u);if(l.length>0){const e=l[0].object;a.remove(e),u=u.filter(o=>o!==e),m+=10,document.getElementById("score").textContent=`分数: ${m}`,y()}}function H(){d.aspect=window.innerWidth/window.innerHeight,d.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}function g(){requestAnimationFrame(g),c.ready!==!1&&s.update(c.domElement),p&&u.forEach(t=>{t.rotation.x+=.01,t.rotation.y+=.01}),i.render(a,d)}document.getElementById("startButton").addEventListener("click",()=>{p=!0,document.getElementById("startButton").style.display="none",m=0,document.getElementById("score").textContent=`分数: ${m}`});R();g();
